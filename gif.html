<html><head>
    <script src="bits.js"></script>
    <script src="bytestream.js"></script>
    <script src="lzw2.js"></script>
    <script src="lzw.js"></script>
    <script src="gif.js"></script>
    <script>
      var toBytes = function(string) {
        var result = [];
        for(var i = 0; i < string.length; i++) {
          result.push(String.fromCharCode(string.charCodeAt(i) & 0xFF));
        }
        return result.join("");
      };
      var getFile = function(fname, callback) {
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
          if(xhr.readyState === 4 && xhr.status === 200) {
            callback(xhr.responseText);
          }
        };
        xhr.open("GET", fname);
        xhr.overrideMimeType('text/plain; charset=x-user-defined'); 
        xhr.send();
      };
        var charCodes = function(s) {
        var result = [];
        for(var i = 0; i <s.length; i++)
          result.push(s.charCodeAt(i).toString(16));
          //result.push((s.charCodeAt(i) & 0xFF).toString(16));
        return result
      }
      roundtrips = function(g) {
        var blocks = [];
        blocks.push(g.screen);
        for(var i = 0; i < 5; i++) {
          blocks.push(g.blocks[i]);
        }
        for(var i = 0; i < blocks.length; i++) {
          var block = blocks[i];
          var constructor = block.__proto__.constructor;
          var encoded = block.encode();
          console.log(asHex(block.encode()));
          var decoded = new constructor();
          if(!decoded.decode(new ByteStream(block.encode()))) {
            throw constructor.toString();
          }
          console.log(asHex(decoded.encode()));
          console.log("==================");

        }
        
      };
      test = function() {
        g = getFile("gifs/bwanim.gif", function(gifdata) {
          g = new Gif();
          now = Date.now();
          g.decode(new ByteStream(gifdata));
          duration = Date.now() - now;
          console.log(g);
          console.log(duration / 1000);
          roundtrips(g);
        });
      };

    </script>
  </head>
</html>
